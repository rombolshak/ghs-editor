"use strict";(self.webpackChunkghs_editor=self.webpackChunkghs_editor||[]).push([[954],{1954:(mt,M,a)=>{a.r(M),a.d(M,{EditionModule:()=>p});var f=a(6895),E=a(5142),F=a(655),c=a(4006),P=a(1135),x=a(4128),U=a(5698),y=a(2722),T=a(8746),Z=a(5577),J=a(8535),w=a(7776),D=a(8923),e=(()=>{return(i=e||(e={})).stun="stun",i.immobilize="immobilize",i.disarm="disarm",i.wound="wound",i.muddle="muddle",i.poison="poison",i.invisible="invisible",i.strengthen="strengthen",i.curse="curse",i.bless="bless",i.regenerate="regenerate",i.chill="chill",i.infect="infect",i.ward="ward",i.bane="bane",i.brittle="brittle",i.impair="impair",i.rupture="rupture",i.poison_x="poison_x",i.wound_x="wound_x",e;var i})(),r=(()=>{return(i=r||(r={})).action="action",i.standard="standard",i.entity="entity",i.character="character",i.monster="monster",i.upgrade="upgrade",i.stack="stack",i.turn="turn",i.expire="expire",i.value="value",i.clearHeal="clearHeal",i.preventHeal="preventHeal",i.apply="apply",i.positive="positive",i.negative="negative",r;var i})();class B{constructor(o,n=1){this.types=[],this.value=1,this.name=o,this.value=n,this.types.push(r.action),-1!=[e.stun,e.immobilize,e.disarm,e.wound,e.muddle,e.poison,e.invisible,e.strengthen,e.regenerate,e.infect,e.bane,e.brittle,e.ward,e.rupture,e.poison_x,e.wound_x].indexOf(this.name)&&this.types.push(r.entity),-1!=[e.stun,e.immobilize,e.disarm,e.wound,e.muddle,e.poison,e.invisible,e.strengthen,e.regenerate,e.infect,e.bane,e.brittle,e.impair,e.rupture,e.ward].indexOf(this.name)&&this.types.push(r.standard),(-1!=this.types.indexOf(r.entity)||-1!=[e.chill,e.impair,e.ward].indexOf(this.name))&&this.types.push(r.character),-1!=this.types.indexOf(r.entity)&&this.types.push(r.monster),-1!=[e.poison_x,e.wound_x].indexOf(this.name)&&(this.types.push(r.upgrade),this.types.push(r.value)),-1!=[e.chill].indexOf(this.name)&&this.types.push(r.stack),-1!=[e.wound,e.wound_x,e.regenerate].indexOf(this.name)&&this.types.push(r.turn),-1!=[e.wound,e.wound_x,e.poison,e.poison_x,e.bane,e.brittle,e.infect,e.rupture].indexOf(this.name)&&this.types.push(r.clearHeal),-1!=[e.poison,e.poison_x,e.ward,e.brittle].indexOf(this.name)&&this.types.push(r.apply),-1!=[e.poison,e.poison_x,e.infect].indexOf(this.name)&&this.types.push(r.preventHeal),-1!=[e.stun,e.immobilize,e.disarm,e.muddle,e.invisible,e.strengthen,e.impair].indexOf(this.name)&&this.types.push(r.expire),-1!=[e.regenerate,e.ward,e.invisible,e.strengthen,e.bless].indexOf(this.name)&&this.types.push(r.positive),-1==this.types.indexOf(r.positive)&&this.types.push(r.negative)}}Object.values(e).map(i=>new B(i));var t=a(4650),v=a(1842),A=a(4004);class u{}u.\u0275fac=function(o){return new(o||u)},u.\u0275mod=t.oAB({type:u}),u.\u0275inj=t.cJS({imports:[f.ez]});var j=a(529);class z{constructor(o,n){this.name=o,this.prefix=n}toString(){return`${this.name} (${this.prefix})`}}class m{constructor(o){this.http=o}getAvailableEditions(){return this.http.get("assets/json/predefined-editions.json",{context:(0,v.DN)({ttl:864e5})}).pipe((0,Z.z)(o=>(0,x.D)(o.map(n=>this.http.get(`assets/json/ghs-data/${n}/label.json`,{context:(0,v.DN)()}))).pipe((0,A.U)(n=>n.map(s=>{const d=Object.keys(s.en.edition)[0];return new z(s.en.edition[d],d)})))))}getEditionConditions(o){return this.http.get(`assets/json/ghs-data/${o}/base.json`,{context:(0,v.DN)()}).pipe((0,A.U)(n=>n.conditions))}}m.\u0275fac=function(o){return new(o||m)(t.LFG(j.eN))},m.\u0275prov=t.Yz7({token:m,factory:m.\u0275fac,providedIn:u});var G=a(8574),H=a(343),k=a(1163),Y=a(9367),I=a(7819),N=a(8276),$=a(9886),R=a(3861),K=a(9343),V=a(4601),X=a(117),W=a(5601),q=a(6772),S=a(6679),_=a(7975),tt=a(2985),et=a(5120);const it=["clearAllConfirmation"];function nt(i,o){1&i&&t._UZ(0,"tui-loader",9),2&i&&t.Q6J("showLoader",!0)}function ot(i,o){if(1&i&&(t._UZ(0,"tui-data-list-wrapper",25),t.ALo(1,"async")),2&i){const n=t.oxw(2);t.Q6J("items",t.lcZ(1,2,n.availableEditionsIds))("itemContent",n.getNameForList)}}function at(i,o){if(1&i&&(t._UZ(0,"tui-data-list-wrapper",25),t.ALo(1,"tuiHideSelected")),2&i){const n=t.oxw(2),s=t.MAs(18);t.Q6J("items",t.lcZ(1,2,n.filterConditions(n.conditionSearch)))("itemContent",s)}}const C=function(){return[]};function rt(i,o){if(1&i){const n=t.EpF();t.TgZ(0,"form",10),t.NdJ("ngSubmit",function(){t.CHM(n);const d=t.oxw();return t.KtG(d.save())}),t.TgZ(1,"div",11)(2,"div")(3,"tui-input",12),t._uU(4," Edition full name "),t._UZ(5,"input",13),t.qZA(),t._UZ(6,"tui-error",14),t.ALo(7,"async"),t.ALo(8,"tuiFieldError"),t.qZA(),t.TgZ(9,"div")(10,"tui-input",15),t._uU(11," Edition prefix "),t._UZ(12,"input",13),t.qZA(),t._UZ(13,"tui-error",14),t.ALo(14,"async"),t.ALo(15,"tuiFieldError"),t.qZA()(),t.TgZ(16,"label",16)(17,"tui-multi-select",17),t._uU(18," Select editions that this new edition extends "),t.YNc(19,ot,2,4,"tui-data-list-wrapper",18),t.qZA(),t._UZ(20,"tui-error",14),t.ALo(21,"async"),t.ALo(22,"tuiFieldError"),t.qZA(),t.TgZ(23,"label",19)(24,"tui-multi-select",20),t.NdJ("searchChange",function(d){t.CHM(n);const l=t.oxw();return t.KtG(l.conditionSearch=d)}),t._uU(25," Select conditions used in this edition "),t.YNc(26,at,2,4,"tui-data-list-wrapper",18),t.qZA()(),t.TgZ(27,"div",21)(28,"div")(29,"button",22),t._uU(30,"Save"),t.qZA(),t.TgZ(31,"button",23),t.NdJ("click",function(){t.CHM(n);const d=t.oxw();return t.KtG(d.reset())}),t._uU(32," Reset "),t.qZA()(),t.TgZ(33,"div")(34,"button",24),t.NdJ("click",function(){t.CHM(n);const d=t.oxw(),l=t.MAs(20);return t.KtG(d.dialogService.open(l,{size:"l"}).subscribe())}),t._uU(35," Clear all data "),t.qZA()()()()}if(2&i){const n=t.oxw();t.Q6J("formGroup",n.editionForm),t.xp6(3),t.Q6J("formControl",n.editionForm.controls.editionName),t.xp6(3),t.Q6J("formControl",n.editionForm.controls.editionName)("error",t.lcZ(7,18,t.lcZ(8,20,t.DdM(30,C)))),t.xp6(4),t.Q6J("formControl",n.editionForm.controls.editionPrefix),t.xp6(3),t.Q6J("formControl",n.editionForm.controls.editionPrefix)("error",t.lcZ(14,22,t.lcZ(15,24,t.DdM(31,C)))),t.xp6(4),t.Q6J("formControl",n.editionForm.controls.extendedEditions)("tuiTextfieldLabelOutside",!0)("editable",!0)("stringify",n.getName),t.xp6(3),t.Q6J("formControl",n.editionForm.controls.extendedEditions)("error",t.lcZ(21,26,t.lcZ(22,28,t.DdM(32,C)))),t.xp6(4),t.Q6J("formControl",n.editionForm.controls.conditions)("tuiTextfieldLabelOutside",!0)("editable",!0)("search",n.conditionSearch),t.xp6(5),t.Q6J("disabled",!n.editionForm.valid||n.editionForm.pristine)}}function st(i,o){if(1&i&&(t.TgZ(0,"div",26),t._UZ(1,"tui-svg",27),t._uU(2),t.qZA()),2&i){const n=o.$implicit;t.xp6(1),t.Q6J("src","assets/images/ghs/condition/"+n+".svg"),t.xp6(1),t.hij(" ",n," ")}}function dt(i,o){if(1&i){const n=t.EpF();t.TgZ(0,"div",28)(1,"header")(2,"section")(3,"h3"),t._uU(4,"Data clear"),t.qZA(),t._UZ(5,"tui-marker-icon",29),t.qZA()(),t.TgZ(6,"ul",30)(7,"li"),t._uU(8,"This will clear all saved data from browser storage, including scenarios, monsters and characters."),t.qZA(),t.TgZ(9,"li"),t._uU(10,"State of the app will be completely empty as if you just loaded it for the first time."),t.qZA(),t.TgZ(11,"li"),t._uU(12,"Be sure to export neccesary data before proceeding."),t.qZA()(),t.TgZ(13,"div",31)(14,"button",32),t.NdJ("click",function(){const l=t.CHM(n).$implicit,b=t.oxw();return t.KtG(b.clearAll(l))}),t._uU(15," Clear data "),t.qZA(),t.TgZ(16,"button",33),t.NdJ("click",function(){const l=t.CHM(n).$implicit;return t.KtG(l.complete())}),t._uU(17," Cancel "),t.qZA()()()}}class g{constructor(o,n,s,d,l,b){this.formBuilder=o,this.dataService=n,this.baseEditionDataService=s,this.destroy$=d,this.alertService=l,this.dialogService=b,this.loading=new P.X(!0),this.availableEditionsIds=new P.X([]),this.conditionSearch=null,this.editionForm=this.formBuilder.nonNullable.group({editionName:["",c.kI.required],editionPrefix:["",c.kI.required],extendedEditions:[[],c.kI.required],conditions:[[]]}),this.getName=O=>this.availableEditions.find(ut=>ut.prefix===O)?.toString()??"<unknown edition>",this.getNameForList=({$implicit:O})=>this.getName(O),this.availableEditions=[],this.savedFormData=null,this.setEditionConditionsOnExtendedEditionsChange()}ngOnInit(){(0,x.D)([this.dataService.getAvailableEditions(),this.baseEditionDataService.baseEditionData$.pipe((0,U.q)(1))]).pipe((0,y.R)(this.destroy$),(0,T.x)(()=>this.loading.next(!1))).subscribe(([o,n])=>{this.availableEditions=o,this.availableEditionsIds.next(o.map(s=>s.prefix)),null!==n&&(this.savedFormData=n,this.editionForm.patchValue(n))})}filterConditions(o){return Object.keys(e).filter(n=>(0,J.LQ)(n,o||""))}save(){const o=this.editionForm.getRawValue();this.baseEditionDataService.updateFullData(o),this.editionForm.markAsPristine(),this.alertService.open("Data saved",{status:"success"}).subscribe(),this.savedFormData=o}reset(){this.savedFormData?this.editionForm.patchValue(this.savedFormData):this.editionForm.reset(),this.editionForm.markAsPristine()}clearAll(o){localStorage.clear(),o.complete(),window.location.reload()}setEditionConditionsOnExtendedEditionsChange(){this.editionForm.controls.extendedEditions.valueChanges.pipe((0,Z.z)(o=>(0,x.D)(o?.map(n=>this.dataService.getEditionConditions(n)))),(0,y.R)(this.destroy$)).subscribe(o=>{const n=o.flat(),s=n.filter((d,l)=>n.indexOf(d)===l);this.editionForm.controls.conditions.setValue(s)})}}g.\u0275fac=function(o){return new(o||g)(t.Y36(c.qu),t.Y36(m),t.Y36(G.C),t.Y36(w.a3),t.Y36(H.J9),t.Y36(k.RO))},g.\u0275cmp=t.Xpm({type:g,selectors:[["ghse-editor"]],viewQuery:function(o,n){if(1&o&&t.Gf(it,7),2&o){let s;t.iGM(s=t.CRH())&&(n.clearDataDialog=s.first)}},features:[t._Bn([w.a3])],decls:21,vars:6,consts:[[1,"page-header"],[1,"tui-text_h2"],[1,"page-content"],[1,"tui-island__title"],[1,"tui-island__paragraph"],["size","xxl",3,"showLoader",4,"ngIf"],["class","tui-form",3,"formGroup","ngSubmit",4,"ngIf"],["conditionOptionTemplate",""],["clearAllConfirmation",""],["size","xxl",3,"showLoader"],[1,"tui-form",3,"formGroup","ngSubmit"],[1,"form-row","multi-field"],["data-automation","edition.fullname",1,"fullName",3,"formControl"],["tuiTextfield",""],[3,"formControl","error"],["data-automation","edition.prefix",1,"prefixName",3,"formControl"],["tuiLabel","Extended editions",1,"form-row"],["data-automation","edition.extendedEditions",3,"formControl","tuiTextfieldLabelOutside","editable","stringify"],["tuiMultiSelectGroup","","data-automation","edition.extendedEditions.list",3,"items","itemContent",4,"tuiDataList"],["tuiLabel","Used conditions",1,"form-row"],["data-automation","edition.conditions",3,"formControl","tuiTextfieldLabelOutside","editable","search","searchChange"],[1,"form-row","buttons"],["tuiButton","","type","submit",3,"disabled"],["tuiButton","","type","button","appearance","outline","data-automation","reset-button",3,"click"],["tuiButton","","type","button","appearance","secondary-destructive","data-automation","clear-all-button",3,"click"],["tuiMultiSelectGroup","","data-automation","edition.extendedEditions.list",3,"items","itemContent"],[1,"condition-option"],[3,"src"],[1,"dialog"],["src","tuiIconAlertCircleLarge"],[1,"tui-text_body-m"],[1,"buttons"],["tuiButton","","type","submit","appearance","accent","data-automation","clear-data-confirm",3,"click"],["tuiButton","","type","button","appearance","outline","data-automation","clear-data-cancel",3,"click"]],template:function(o,n){1&o&&(t.TgZ(0,"div",0)(1,"h2",1),t._uU(2,"Edition data"),t.qZA()(),t.TgZ(3,"div",2)(4,"tui-island")(5,"h3",3),t._uU(6,"Welcome to GHS Data Editor"),t.qZA(),t.TgZ(7,"p",4),t._uU(8,"You will need to specify your edition properties first."),t.qZA(),t.TgZ(9,"p",4),t._uU(10," Edition prefix is mandatory, it will be specified in all other entities you create. "),t.qZA(),t.TgZ(11,"p",4),t._uU(12," Extended editions selection defines which monsters will be available for scenarios. "),t.qZA()(),t.YNc(13,nt,1,1,"tui-loader",5),t.ALo(14,"async"),t.YNc(15,rt,36,33,"form",6),t.ALo(16,"async"),t.qZA(),t.YNc(17,st,3,2,"ng-template",null,7,t.W1O),t.YNc(19,dt,18,0,"ng-template",null,8,t.W1O)),2&o&&(t.xp6(13),t.Q6J("ngIf",t.lcZ(14,2,n.loading)),t.xp6(2),t.Q6J("ngIf",!1===t.lcZ(16,4,n.loading)))},dependencies:[f.O5,c._Y,c.JJ,c.JL,c.oH,c.sg,Y.v0,I.kM,N.P,W.h,$.xT,R.gX,K.A,V.v,q.eC,S.K3,S.wU,X.MB,_.VT,_.Qp,tt.B,f.Ov,et.Ag,_.E6],styles:[".ghse-item-box[_ngcontent-%COMP%]{width:auto;border:1px solid var(--tui-base-03);border-radius:var(--tui-radius-m);padding:1rem}.ghse-item-box[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]:last-child{margin-bottom:0}.ghse-item-box[_ngcontent-%COMP%]   .delete[_ngcontent-%COMP%]{cursor:pointer;color:var(--tui-base-05);margin-left:1rem}.ghse-item-box[_ngcontent-%COMP%]   .delete[_ngcontent-%COMP%]:hover{color:var(--tui-base-06)}[_nghost-%COMP%]{display:flex;flex-direction:column;width:100%;flex:1}[_nghost-%COMP%]   .page-header[_ngcontent-%COMP%]{padding:3rem;box-shadow:inset 0 -1px var(--tui-base-03)}[_nghost-%COMP%]   .page-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .page-header.with-link[_ngcontent-%COMP%]{padding:1.5rem 3rem 0rem}[_nghost-%COMP%]   .page-header.with-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   tui-svg[_ngcontent-%COMP%]{width:.5rem}[_nghost-%COMP%]   .page-header.with-button[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}[_nghost-%COMP%]   .page-header.with-button[_ngcontent-%COMP%]   a[tuiButton][_ngcontent-%COMP%], [_nghost-%COMP%]   .page-header.with-button[_ngcontent-%COMP%]   button[tuiButton][_ngcontent-%COMP%]{margin-left:2rem;margin-top:.5rem}[_nghost-%COMP%]   .page-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:1.5rem 3rem}[_nghost-%COMP%]   .page-content[_ngcontent-%COMP%]   tui-loader[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{width:40rem}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{margin-bottom:1.5rem}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .multi-field[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:3rem}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:not(:last-child){margin-right:1.5rem}[_nghost-%COMP%]   tui-island[_ngcontent-%COMP%]{width:38rem;background:var(--tui-base-02);margin-bottom:1.5rem}[_nghost-%COMP%]   .fullName[_ngcontent-%COMP%]{width:30rem}[_nghost-%COMP%]   .prefixName[_ngcontent-%COMP%]{width:9rem}[_nghost-%COMP%]   .checkbox-content[_ngcontent-%COMP%]{width:35.75rem;display:flex;justify-content:space-between}.dialog[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]{width:calc(100% + 4rem);margin-top:-2rem;margin-left:-2rem;margin-bottom:3rem;text-align:center;word-wrap:break-word;background:var(--tui-accent);border-radius:1rem 1rem 0 0}.dialog[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]{position:relative;height:7.25rem}.dialog[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font:var(--tui-font-heading-3);text-align:center;margin:0;padding-top:1rem;color:var(--tui-text-01-night)}.dialog[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]   tui-marker-icon[_ngcontent-%COMP%]{margin-top:1rem;color:var(--tui-base-02);background:var(--tui-accent);box-shadow:0 0 0 2px var(--tui-base-02)}.dialog[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{font:var(--tui-font-text-m)}.dialog[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{margin-top:2rem;text-align:center}.dialog[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:3rem}"],changeDetection:0}),(0,F.gn)([D.UM],g.prototype,"filterConditions",null);const lt=[{path:"",component:g},{path:"**",redirectTo:"",pathMatch:"full"}];class h{}h.\u0275fac=function(o){return new(o||h)},h.\u0275mod=t.oAB({type:h}),h.\u0275inj=t.cJS({imports:[E.Bz.forChild(lt),E.Bz]});var ct=a(4466);class p{}p.\u0275fac=function(o){return new(o||p)},p.\u0275mod=t.oAB({type:p}),p.\u0275inj=t.cJS({imports:[f.ez,h,u,ct.m]})}}]);