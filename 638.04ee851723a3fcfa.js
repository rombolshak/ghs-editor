"use strict";(self.webpackChunkghs_editor=self.webpackChunkghs_editor||[]).push([[638],{4638:(ht,y,s)=>{s.r(y),s.d(y,{EditionModule:()=>g});var v=s(6895),l=s(4006),b=s(5142),A=s(655),Z=s(1135),x=s(4128),U=s(5698),_=s(2722),D=s(8746),P=s(5577),J=s(8535),S=s(9383),L=s(8923),i=(()=>{return(e=i||(i={})).stun="stun",e.immobilize="immobilize",e.disarm="disarm",e.wound="wound",e.muddle="muddle",e.poison="poison",e.invisible="invisible",e.strengthen="strengthen",e.curse="curse",e.bless="bless",e.regenerate="regenerate",e.chill="chill",e.infect="infect",e.ward="ward",e.bane="bane",e.brittle="brittle",e.impair="impair",e.rupture="rupture",e.poison_x="poison_x",e.wound_x="wound_x",i;var e})(),a=(()=>{return(e=a||(a={})).action="action",e.standard="standard",e.entity="entity",e.character="character",e.monster="monster",e.upgrade="upgrade",e.stack="stack",e.turn="turn",e.expire="expire",e.value="value",e.clearHeal="clearHeal",e.preventHeal="preventHeal",e.apply="apply",e.positive="positive",e.negative="negative",a;var e})();class Q{constructor(n,o=1){this.types=[],this.value=1,this.name=n,this.value=o,this.types.push(a.action),-1!=[i.stun,i.immobilize,i.disarm,i.wound,i.muddle,i.poison,i.invisible,i.strengthen,i.regenerate,i.infect,i.bane,i.brittle,i.ward,i.rupture,i.poison_x,i.wound_x].indexOf(this.name)&&this.types.push(a.entity),-1!=[i.stun,i.immobilize,i.disarm,i.wound,i.muddle,i.poison,i.invisible,i.strengthen,i.regenerate,i.infect,i.bane,i.brittle,i.impair,i.rupture,i.ward].indexOf(this.name)&&this.types.push(a.standard),(-1!=this.types.indexOf(a.entity)||-1!=[i.chill,i.impair,i.ward].indexOf(this.name))&&this.types.push(a.character),-1!=this.types.indexOf(a.entity)&&this.types.push(a.monster),-1!=[i.poison_x,i.wound_x].indexOf(this.name)&&(this.types.push(a.upgrade),this.types.push(a.value)),-1!=[i.chill].indexOf(this.name)&&this.types.push(a.stack),-1!=[i.wound,i.wound_x,i.regenerate].indexOf(this.name)&&this.types.push(a.turn),-1!=[i.wound,i.wound_x,i.poison,i.poison_x,i.bane,i.brittle,i.infect,i.rupture].indexOf(this.name)&&this.types.push(a.clearHeal),-1!=[i.poison,i.poison_x,i.ward,i.brittle].indexOf(this.name)&&this.types.push(a.apply),-1!=[i.poison,i.poison_x,i.infect].indexOf(this.name)&&this.types.push(a.preventHeal),-1!=[i.stun,i.immobilize,i.disarm,i.muddle,i.invisible,i.strengthen,i.impair].indexOf(this.name)&&this.types.push(a.expire),-1!=[i.regenerate,i.ward,i.invisible,i.strengthen,i.bless].indexOf(this.name)&&this.types.push(a.positive),-1==this.types.indexOf(a.positive)&&this.types.push(a.negative)}}Object.values(i).map(e=>new Q(e));var t=s(4650),E=s(1842),w=s(4004);class u{}u.\u0275fac=function(n){return new(n||u)},u.\u0275mod=t.oAB({type:u}),u.\u0275inj=t.cJS({imports:[v.ez]});var j=s(529);class B{constructor(n,o){this.name=n,this.prefix=o}toString(){return`${this.name} (${this.prefix})`}}class h{constructor(n){this.http=n}getAvailableEditions(){return this.http.get("assets/json/predefined-editions.json",{context:(0,E.DN)({ttl:864e5})}).pipe((0,P.z)(n=>(0,x.D)(n.map(o=>this.http.get(`assets/json/ghs-data/${o}/label.json`,{context:(0,E.DN)()}))).pipe((0,w.U)(o=>o.map(r=>{const d=Object.keys(r.en.edition)[0];return new B(r.en.edition[d],d)})))))}getEditionConditions(n){return this.http.get(`assets/json/ghs-data/${n}/base.json`,{context:(0,E.DN)()}).pipe((0,w.U)(o=>o.conditions))}}h.\u0275fac=function(n){return new(n||h)(t.LFG(j.eN))},h.\u0275prov=t.Yz7({token:h,factory:h.\u0275fac,providedIn:u});var Y=s(8521),I=s(5983);const G={editionName:"",editionPrefix:"",extendedEditions:[],conditions:[]};class m extends Y.v{constructor(n){super(),this.initialize("base",n.create(G)),this.baseEditionData$=this.model.data$}updateFullData(n){this.model.set(n)}}m.\u0275fac=function(n){return new(n||m)(t.LFG(I.u))},m.\u0275prov=t.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"});var H=s(343),$=s(9367),N=s(7819),R=s(8276),X=s(9886),V=s(3861),K=s(9343),W=s(4601),k=s(117),q=s(5601),tt=s(6772),F=s(6679),C=s(5855),it=s(5120);function et(e,n){1&e&&t._UZ(0,"tui-loader",8),2&e&&t.Q6J("showLoader",!0)}function nt(e,n){if(1&e&&(t._UZ(0,"tui-data-list-wrapper",23),t.ALo(1,"async")),2&e){const o=t.oxw(2);t.Q6J("items",t.lcZ(1,2,o.availableEditionsIds))("itemContent",o.getNameForList)}}function ot(e,n){if(1&e&&(t._UZ(0,"tui-data-list-wrapper",23),t.ALo(1,"tuiHideSelected")),2&e){const o=t.oxw(2),r=t.MAs(18);t.Q6J("items",t.lcZ(1,2,o.filterConditions(o.conditionSearch)))("itemContent",r)}}const O=function(){return[]};function st(e,n){if(1&e){const o=t.EpF();t.TgZ(0,"form",9),t.NdJ("ngSubmit",function(){t.CHM(o);const d=t.oxw();return t.KtG(d.save())}),t.TgZ(1,"div",10)(2,"div")(3,"tui-input",11),t._uU(4," Edition full name "),t._UZ(5,"input",12),t.qZA(),t._UZ(6,"tui-error",13),t.ALo(7,"async"),t.ALo(8,"tuiFieldError"),t.qZA(),t.TgZ(9,"div")(10,"tui-input",14),t._uU(11," Edition prefix "),t._UZ(12,"input",12),t.qZA(),t._UZ(13,"tui-error",13),t.ALo(14,"async"),t.ALo(15,"tuiFieldError"),t.qZA()(),t.TgZ(16,"label",15)(17,"tui-multi-select",16),t._uU(18," Select editions that this new edition extends "),t.YNc(19,nt,2,4,"tui-data-list-wrapper",17),t.qZA(),t._UZ(20,"tui-error",13),t.ALo(21,"async"),t.ALo(22,"tuiFieldError"),t.qZA(),t.TgZ(23,"label",18)(24,"tui-multi-select",19),t.NdJ("searchChange",function(d){t.CHM(o);const c=t.oxw();return t.KtG(c.conditionSearch=d)}),t._uU(25," Select conditions used in this edition "),t.YNc(26,ot,2,4,"tui-data-list-wrapper",17),t.qZA()(),t.TgZ(27,"div",20)(28,"button",21),t._uU(29,"Save"),t.qZA(),t.TgZ(30,"button",22),t.NdJ("click",function(){t.CHM(o);const d=t.oxw();return t.KtG(d.reset())}),t._uU(31," Reset "),t.qZA()()()}if(2&e){const o=t.oxw();t.Q6J("formGroup",o.editionForm),t.xp6(3),t.Q6J("formControl",o.editionForm.controls.editionName),t.xp6(3),t.Q6J("formControl",o.editionForm.controls.editionName)("error",t.lcZ(7,18,t.lcZ(8,20,t.DdM(30,O)))),t.xp6(4),t.Q6J("formControl",o.editionForm.controls.editionPrefix),t.xp6(3),t.Q6J("formControl",o.editionForm.controls.editionPrefix)("error",t.lcZ(14,22,t.lcZ(15,24,t.DdM(31,O)))),t.xp6(4),t.Q6J("formControl",o.editionForm.controls.extendedEditions)("tuiTextfieldLabelOutside",!0)("editable",!0)("stringify",o.getName),t.xp6(3),t.Q6J("formControl",o.editionForm.controls.extendedEditions)("error",t.lcZ(21,26,t.lcZ(22,28,t.DdM(32,O)))),t.xp6(4),t.Q6J("formControl",o.editionForm.controls.conditions)("tuiTextfieldLabelOutside",!0)("editable",!0)("search",o.conditionSearch),t.xp6(4),t.Q6J("disabled",!o.editionForm.valid||o.editionForm.pristine)}}function at(e,n){if(1&e&&(t.TgZ(0,"div",24),t._UZ(1,"tui-svg",25),t._uU(2),t.qZA()),2&e){const o=n.$implicit;t.xp6(1),t.Q6J("src","assets/images/ghs/condition/"+o+".svg"),t.xp6(1),t.hij(" ",o," ")}}class p{constructor(n,o,r,d,c){this.formBuilder=n,this.dataService=o,this.baseEditionDataService=r,this.destroy$=d,this.alertService=c,this.loading=new Z.X(!0),this.availableEditionsIds=new Z.X([]),this.conditionSearch=null,this.editionForm=this.formBuilder.nonNullable.group({editionName:["",l.kI.required],editionPrefix:["",l.kI.required],extendedEditions:[[],l.kI.required],conditions:[[]]}),this.getName=M=>this.availableEditions.find(ut=>ut.prefix===M)?.toString()??"<unknown edition>",this.getNameForList=({$implicit:M})=>this.getName(M),this.availableEditions=[],this.savedFormData=null,this.setEditionConditionsOnExtendedEditionsChange()}ngOnInit(){(0,x.D)([this.dataService.getAvailableEditions(),this.baseEditionDataService.baseEditionData$.pipe((0,U.q)(1))]).pipe((0,_.R)(this.destroy$),(0,D.x)(()=>this.loading.next(!1))).subscribe(([n,o])=>{this.availableEditions=n,this.availableEditionsIds.next(n.map(r=>r.prefix)),null!==o&&(this.savedFormData=o,this.editionForm.patchValue(o))})}filterConditions(n){return Object.keys(i).filter(o=>(0,J.LQ)(o,n||""))}save(){const n=this.editionForm.getRawValue();this.baseEditionDataService.updateFullData(n),this.editionForm.markAsPristine(),this.alertService.open("Data saved",{status:"success"}).subscribe(),this.savedFormData=n}reset(){this.savedFormData?this.editionForm.patchValue(this.savedFormData):this.editionForm.reset(),this.editionForm.markAsPristine()}setEditionConditionsOnExtendedEditionsChange(){this.editionForm.controls.extendedEditions.valueChanges.pipe((0,P.z)(n=>(0,x.D)(n?.map(o=>this.dataService.getEditionConditions(o)))),(0,_.R)(this.destroy$)).subscribe(n=>{const o=n.flat(),r=o.filter((d,c)=>o.indexOf(d)===c);this.editionForm.controls.conditions.setValue(r)})}}p.\u0275fac=function(n){return new(n||p)(t.Y36(l.qu),t.Y36(h),t.Y36(m),t.Y36(S.a3),t.Y36(H.J9))},p.\u0275cmp=t.Xpm({type:p,selectors:[["ghse-editor"]],features:[t._Bn([S.a3])],decls:19,vars:6,consts:[[1,"page-header"],[1,"tui-text_h2"],[1,"page-content"],[1,"tui-island__title"],[1,"tui-island__paragraph"],["size","xxl",3,"showLoader",4,"ngIf"],["class","tui-form",3,"formGroup","ngSubmit",4,"ngIf"],["conditionOptionTemplate",""],["size","xxl",3,"showLoader"],[1,"tui-form",3,"formGroup","ngSubmit"],[1,"name-fields","form-row"],["data-automation","edition.fullname",1,"fullName",3,"formControl"],["tuiTextfield",""],[3,"formControl","error"],["data-automation","edition.prefix",1,"prefixName",3,"formControl"],["tuiLabel","Extended editions",1,"form-row"],["data-automation","edition.extendedEditions",3,"formControl","tuiTextfieldLabelOutside","editable","stringify"],["tuiMultiSelectGroup","","data-automation","edition.extendedEditions.list",3,"items","itemContent",4,"tuiDataList"],["tuiLabel","Used conditions",1,"form-row"],["data-automation","edition.conditions",3,"formControl","tuiTextfieldLabelOutside","editable","search","searchChange"],[1,"form-row","buttons"],["tuiButton","","type","submit","size","m",3,"disabled"],["tuiButton","","type","button","appearance","outline","size","m","data-automation","reset-button",3,"click"],["tuiMultiSelectGroup","","data-automation","edition.extendedEditions.list",3,"items","itemContent"],[1,"condition-option"],[3,"src"]],template:function(n,o){1&n&&(t.TgZ(0,"div",0)(1,"h2",1),t._uU(2,"Edition data"),t.qZA()(),t.TgZ(3,"div",2)(4,"tui-island")(5,"h3",3),t._uU(6,"Welcome to GHS Data Editor"),t.qZA(),t.TgZ(7,"p",4),t._uU(8,"You will need to specify your edition properties first."),t.qZA(),t.TgZ(9,"p",4),t._uU(10," Edition prefix is mandatory, it will be specified in all other entities you create. "),t.qZA(),t.TgZ(11,"p",4),t._uU(12," Extended editions selection defines which monsters will be available for scenarios. "),t.qZA()(),t.YNc(13,et,1,1,"tui-loader",5),t.ALo(14,"async"),t.YNc(15,st,32,33,"form",6),t.ALo(16,"async"),t.qZA(),t.YNc(17,at,3,2,"ng-template",null,7,t.W1O)),2&n&&(t.xp6(13),t.Q6J("ngIf",t.lcZ(14,2,o.loading)),t.xp6(2),t.Q6J("ngIf",!1===t.lcZ(16,4,o.loading)))},dependencies:[v.O5,l._Y,l.JJ,l.JL,l.oH,l.sg,$.v0,N.kM,R.P,q.h,X.xT,V.gX,K.A,W.v,tt.eC,F.K3,F.wU,k.MB,C.VT,C.Qp,v.Ov,it.Ag,C.E6],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;width:100%}[_nghost-%COMP%]   .page-header[_ngcontent-%COMP%]{padding:3rem;box-shadow:inset 0 -1px var(--tui-base-03)}[_nghost-%COMP%]   .page-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .page-header.with-link[_ngcontent-%COMP%]{padding:1.5rem 3rem 3rem}[_nghost-%COMP%]   .page-header.with-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   tui-svg[_ngcontent-%COMP%]{width:.5rem}[_nghost-%COMP%]   .page-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:1.5rem 3rem}[_nghost-%COMP%]   .page-content[_ngcontent-%COMP%]   tui-loader[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   tui-island[_ngcontent-%COMP%]{width:38rem;background:var(--tui-base-02)}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{margin-top:2rem;width:40rem}[_nghost-%COMP%]   .form-row[_ngcontent-%COMP%]{margin-bottom:1rem}[_nghost-%COMP%]   .name-fields[_ngcontent-%COMP%]{display:flex;justify-content:space-between}[_nghost-%COMP%]   .name-fields[_ngcontent-%COMP%]   .fullName[_ngcontent-%COMP%]{width:30rem}[_nghost-%COMP%]   .name-fields[_ngcontent-%COMP%]   .prefixName[_ngcontent-%COMP%]{width:9rem}[_nghost-%COMP%]   .checkbox-content[_ngcontent-%COMP%]{width:35.75rem;display:flex;justify-content:space-between}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]{margin-top:2rem}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:1rem}"],changeDetection:0}),(0,A.gn)([L.UM],p.prototype,"filterConditions",null);const rt=[{path:"",component:p},{path:"**",redirectTo:"",pathMatch:"full"}];class f{}f.\u0275fac=function(n){return new(n||f)},f.\u0275mod=t.oAB({type:f}),f.\u0275inj=t.cJS({imports:[b.Bz.forChild(rt),b.Bz]});var dt=s(3675),lt=s(4886),ct=s(4466);class g{}g.\u0275fac=function(n){return new(n||g)},g.\u0275mod=t.oAB({type:g}),g.\u0275inj=t.cJS({imports:[v.ez,f,u,l.UX,l.UX,dt.Q,lt.go,ct.m]})}}]);